@page "/admin/DashboardAdmin"
@namespace gestaopedagogica.Pages.Admin
@layout MainLayout
@using Microsoft.AspNetCore.Components.Authorization
@using gestaopedagogica.Services

@inject AdminService AdminService
@inject AuthenticationStateProvider AuthStateProvider

<AuthorizeView Roles="Administrador">
    <Authorized>
        @if (!string.IsNullOrEmpty(successMessage))
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                @((MarkupString)successMessage)
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }

        <h3 class="mb-4">Dashboard do Administrador</h3>

        <div class="row mb-3">
            <div class="col-md-12">
                <a href="/admin/ListarUtilizadores" class="btn btn-info btn-custom mb-3">
                    📋 Gerir Utilizadores
                </a>
            </div>
        </div>

        <div class="row g-3">
            <!-- Total de Alunos -->
            <div class="col-md-4">
                <div class="card card-custom p-3">
                    <h5 class="mb-2">Total de Alunos</h5>
                    <p>@TotalAlunos</p>
                </div>
            </div>

            <!-- Total de Professores -->
            <div class="col-md-4">
                <div class="card card-custom p-3">
                    <h5 class="mb-2">Total de Professores</h5>
                    <p>@TotalProfessores</p>
                </div>
            </div>

            <!-- Registar Utilizador -->
            <div class="col-md-4">
                <div class="card card-custom p-3">
                    <h5 class="mb-2">Registar Utilizador</h5>
                    <p>Criar nova conta de utilizador</p>
                    <a href="/admin/RegisterAdmin" class="btn btn-primary btn-custom btn-sm">Registar</a>
                </div>
            </div>
        </div>
    </Authorized>
    <NotAuthorized>
        <div class="alert alert-danger mt-5 card-custom">
            <h4>Acesso Negado</h4>
            <p>Você não tem permissão para acessar o dashboard do administrador.</p>
            <p>Por favor, <a href="/login">faça login novamente</a> com uma conta de administrador.</p>
        </div>
    </NotAuthorized>
</AuthorizeView>

@code {
    private string? successMessage;

    private int TotalAlunos { get; set; }
    private int TotalProfessores { get; set; }

    protected override async Task OnInitializedAsync()
    {
        // Carregar totais do AdminService
        TotalAlunos = await AdminService.GetTotalAlunosAsync();
        TotalProfessores = await AdminService.GetTotalProfessoresAsync();
    }
}
